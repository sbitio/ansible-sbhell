# Ansible s(b)hell

Ansible role providing modules (action plugins) to ease shell invocations.



## Modules

### sbhell

Perform shell invocations with extra logging capabilities.

It accepts the same parameters as the `shell` module, but doesn't support
the "free form" because of Ansible restrictions. Instead pass the command
to run via the `command` parameter:

```yaml

- name: sbhell task
  sbhell: command='ls /'
```

Additionally the module accepts an extra parameter `log` to enhance the logging
of the shell execution. This parameter is a hash with those defaults:

```yaml
log:
  enabled: true
  #logfile: <autogenerated>
  preserve: false
  debug: true
```

 * `enabled`: whether to log the command output to a file
 * `logfile`: file to save the command output. It is autogenerated if not provided
 * `debug`: whether to print the command output via `debug` module


### drush

[Drush](https://github.com/drush-ops/drush) invocations via sbhell.

It accepts the same parameters as the `sbhell` module above but `command`.

Additional parameters:

 * `executable`: path to drush executable. Defaults to 'drush'
 * `args`:' arguments to provide for the command execution. Defaults to '-y --nocolor'
 * `alias`: Drush alias. Defaults to '@none'
 * `command`: Drush command. Defaults to 'status'
 * `memory_limit`: PHP memory limit. Not set if empty


## Example Playbook

Including an example of how to use your role (for instance, with variables passed in as parameters) is always nice for users too:

```yaml
- hosts: localhost
  vars:
    drush_executable   : '/opt/drush/9/drush'
    drush_memory_limit : '3072M'

  roles:
    - { role: ansible-sbhell, drush_args: '-y --no-ansi' }

  tasks:
    - name: test shell
      sbhell:
      args:
        command: 'ls /'
        log:
          enabled: true
          debug: true
          preserve: false

    - name: test drush
      drush:
      args:
        alias: '@d7'
        command: php-eval "return ini_get(\"memory_limit\")"
```


License
-------

MIT

Author Information
------------------

SB IT Media, S.L.
